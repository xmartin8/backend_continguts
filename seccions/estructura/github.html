<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Mostrar codi PHP amb Highlight.js</title>

    <!-- Highlight.js CSS fosc -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/monokai-sublime.min.css">
    

    <style>
        body {
            font-family: monospace;
            background-color: #2d2d2d; /* fons fosc */
            color: #ccc;
            padding: 20px;
        }
        pre {
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

<pre><code class="php" id="php-code">Carregant...</code></pre>

<!-- Highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/php.min.js"></script>
<script>
    const phpCode = `

<?php

if (session_status() == PHP_SESSION_NONE) { 
    session_start(); 
}
if (isset($_SESSION['userId'])) {
    header('Location: login.php');
    return;
}

// Hybridauth autoloader
require_once '../lib/hybridauth/src/autoload.php';
require_once '../controller/social-auth-common.php';

// Configuració pel nostre provider


$config = [
    //'callback' => 'http://localhost/.../oauth/github.php',
    'callback' => 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . '/oauth/github.php', 
    'keys' => [
        'id' => 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 
        'secret' => 'XXXXX XXXXXX XXX XXXXXXX XXXXxx',
    ]
];
echo 'Callback URL: ' . $config['callback'];

try {
    $github = new Hybridauth\Provider\GitHub($config);

    // Demanem a l'usuari que s'autentiqui amb GitHub
    $github->authenticate();

    // Obtenim el token d'accés
    $accessToken = $github->getAccessToken();

    $userProfile = $github->getUserProfile(); // obtenim l'user profile, que conté diversa informació de l'usuari
    $displayName = $userProfile->displayName; // obtenim el nickname
    $email = $userProfile->email; // i el correu

    // Registrem l'usuari si no ho està i el loguem
    loginSocialProviderUser($email, $displayName, "GitHub");

    // Tanquem el popup i actualitzem la finestra mare
    closeWindowAndReloadParent();
} catch (\Exception $e) {
    echo $e->getMessage();
}`;

    const codeBlock = document.getElementById('php-code');
    codeBlock.textContent = phpCode;

    // Inicialitza Highlight.js
    hljs.highlightElement(codeBlock);
</script>

</body>
</html>
