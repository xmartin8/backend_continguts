<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Mostrar codi PHP amb Highlight.js</title>

    <!-- Highlight.js CSS fosc -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/monokai-sublime.min.css">
    

    <style>
        body {
            font-family: monospace;
            background-color: #2d2d2d; /* fons fosc */
            color: #ccc;
            padding: 20px;
        }
        pre {
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

<pre><code class="php" id="php-code">Carregant...</code></pre>

<!-- Highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/php.min.js"></script>
<script>
    const phpCode = `<?php


if (session_status() == PHP_SESSION_NONE) { 
    session_start(); 
}

require_once "../model/pdo-users.php";
require_once "../controller/session.php";
require_once "../controller/social-auth-common.php";
require_once '../vendor/autoload.php'; 

if (isset($_SESSION['userId'])) {
    header('Location: login.php');
    return;
}

// init configuration
	$clientID = 'CLIENT_ID';
	$clientSecret = 'CLIENT_SECRET';
	$redirectUri = 'http://localhost/.../login.php';

	/***
	 * 	// create Client Request to access Google API
	$client = new Google_Client();
	$client->setClientId($clientID);
	$client->setClientSecret($clientSecret);
	$client->setRedirectUri($redirectUri);
	$client->addScope("email");
	$client->addScope("profile");
	 * 
	 */

	$client = new Google_Client();
	$client->setClientId('CLIENT_ID');
	$client->setClientSecret('CLIENT_SECRET');
	$client->setRedirectUri('http://localhost/.../oauth/google.php');
	$client->addScope("email");
	$client->addScope("profile");

	// authenticate code from Google OAuth Flow
	
	if (isset($_GET['code'])) {
		$token = $client->fetchAccessTokenWithAuthCode($_GET['code']);
		$client->setAccessToken($token['access_token']);

		// get profile info
		$google_oauth = new Google_Service_Oauth2($client);
		$google_account_info = $google_oauth->userinfo->get();
		$email =  $google_account_info->email;
		$name =  $google_account_info->name;

		$_SESSION['usuari'] = [
			"name" => $name,
			"email" => $email,
			"accessType" => "Google"
		];
		header('Location: contingut.php');
		die();
	}


    ?>`;

    const codeBlock = document.getElementById('php-code');
    codeBlock.textContent = phpCode;

    // Inicialitza Highlight.js
    hljs.highlightElement(codeBlock);
</script>

</body>
</html>
